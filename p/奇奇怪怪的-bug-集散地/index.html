<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="平时遇到的奇怪代码问题，记录并整理。"><title>奇奇怪怪的 Bug 集散地</title>
<link rel=canonical href=https://axi404.github.io/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/><link rel=stylesheet href=/Blog/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="奇奇怪怪的 Bug 集散地"><meta property='og:description' content="平时遇到的奇怪代码问题，记录并整理。"><meta property='og:url' content='https://axi404.github.io/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/'><meta property='og:site_name' content='Axi404'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Tech Talk'><meta property='article:tag' content='Bug Report'><meta property='article:published_time' content='2024-08-17T17:30:00+08:00'><meta property='article:modified_time' content='2024-08-17T17:30:00+08:00'><meta property='og:image' content='https://axi404.github.io/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/cover.jpg'><meta name=twitter:title content="奇奇怪怪的 Bug 集散地"><meta name=twitter:description content="平时遇到的奇怪代码问题，记录并整理。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://axi404.github.io/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/cover.jpg'><link rel="shortcut icon" href=/Blog/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/Blog/><img src=/Blog/img/avatar_hu12164355173948498683.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>❤️</span></figure><div class=site-meta><h1 class=site-name><a href=/Blog>Axi404</a></h1><h2 class=site-description>你好，我是阿汐，欢迎。</h2></div></header><ol class=menu-social><li><a href=https://github.com/Axi404 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/Blog/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/Blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/Blog/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/Blog/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/Blog/repos/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Repos</span></a></li><li><a href=/Blog/%E5%8F%8B%E9%93%BE/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友链</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#博客渲染超时>博客渲染超时</a></li><li><a href=#cuda--cudnn--pytorch-安装>CUDA & CUDNN & Pytorch 安装</a></li><li><a href=#ubuntu-2204-三系统安装以及安装显卡驱动后无线网卡恢复>Ubuntu 22.04 三系统安装以及安装显卡驱动后无线网卡恢复</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/><img src=/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/cover_hu3342639474510153015.jpg srcset="/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/cover_hu3342639474510153015.jpg 800w, /Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/cover_hu10020712749960797391.jpg 1600w" width=800 height=1067 loading=lazy alt="Featured image of post 奇奇怪怪的 Bug 集散地"></a></div><div class=article-details><header class=article-category><a href=/Blog/categories/tech-talk/ style=background-color:#b12319;color:#fff>Tech Talk</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/Blog/p/%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84-bug-%E9%9B%86%E6%95%A3%E5%9C%B0/>奇奇怪怪的 Bug 集散地</a></h2><h3 class=article-subtitle>平时遇到的奇怪代码问题，记录并整理。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 17, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=前言>前言</h2><p>平时遇到一些奇怪的代码问题，记录并整理。</p><h2 id=博客渲染超时>博客渲染超时</h2><p>在 Hugo 中，如果博客文章较多，渲染时间会非常长，导致渲染超时。具体考量可能是因为担心无限递归之类的，hugo 使用了粗暴的解决方法，超时就中断并且报错。所以解决方法也很简单，修改 <code>config.toml</code> 文件中的 <code>timeout</code> 配置项，增加渲染超时时间，单位貌似是毫秒。之前一直没有看 Github 详细报错，之前又出现过 Github Actions 瘫痪，我还以为又出现了，re-run 之后也就好了，估计是因为当初体量卡在临界点上，现在彻底超时了，也就发现了这个问题。</p><h2 id=cuda--cudnn--pytorch-安装>CUDA & CUDNN & Pytorch 安装</h2><p>因为之前的 Ubuntu 系统又因为我自己的不小心所以坏掉了，于是又一次尝试重装系统，但是出现了很多的问题。</p><p>我的系统是 Ubuntu 20.04.6，在清华大学镜像站下载的最新版，电脑显卡是 NVIDIA GeForce RTX 3070 Laptop，可以支持 CUDA 12.2，在本段内容书写的时候，Torch 的官网使用的最标准的 pytorch 是 CUDA 12.1 的，所以安装这个版本，以及 9.3.0 的 CUDNN。</p><p>首先给出下载 CUDA 和 CUDNN 的官网，其中 CUDA 12.1 为 <a class=link href=https://developer.nvidia.com/cuda-12-1-0-download-archive target=_blank rel=noopener>https://developer.nvidia.com/cuda-12-1-0-download-archive</a>，CUDNN 9.3.0 为 <a class=link href=https://developer.nvidia.com/cudnn-downloads target=_blank rel=noopener>https://developer.nvidia.com/cudnn-downloads</a>，之后依次选择自己的系统版本即可。其中 CUDA 的安装方法使用的是 <code>runfile (local)</code>，并且在此之前运行了 <code>sudo ubuntu-drivers autoinstall</code> 并重启以安装 driver。</p><p>问题出现在，对于任何一个全新的最小安装的 Ubuntu 20.04 系统，在使用 runfile 的时候，均会报错，并说明在 <code>/var/log/nvidia-installer.log</code> 中可以看到详情，其最后为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>-&gt; Error.
</span></span><span class=line><span class=cl>ERROR: An error occurred while performing the step: &#34;Checking to see whether the nvidia kernel module was successfully built&#34;. See /var/log/nvidia-installer.log for details.
</span></span><span class=line><span class=cl>-&gt; The command `cd ./kernel; /usr/bin/make -k -j16  NV_EXCLUDE_KERNEL_MODULES=&#34;&#34; SYSSRC=&#34;/lib/modules/5.15.0-117-generic/build&#34; SYSOUT=&#34;/lib/modules/5.15.0-117-generic/build&#34; NV_KERNEL_MODULES=&#34;nvidia&#34;` failed with the following output:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>make[1]: Entering directory &#39;/usr/src/linux-headers-5.15.0-117-generic&#39;
</span></span><span class=line><span class=cl>warning: the compiler differs from the one used to build the kernel
</span></span><span class=line><span class=cl>  The kernel was built by: gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0
</span></span><span class=line><span class=cl>  You are using:           cc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0
</span></span><span class=line><span class=cl>  MODPOST /tmp/selfgz3405/NVIDIA-Linux-x86_64-530.30.02/kernel/Module.symvers
</span></span><span class=line><span class=cl>ERROR: modpost: GPL-incompatible module nvidia.ko uses GPL-only symbol &#39;rcu_read_unlock_strict&#39;
</span></span><span class=line><span class=cl>make[2]: *** [scripts/Makefile.modpost:133: /tmp/selfgz3405/NVIDIA-Linux-x86_64-530.30.02/kernel/Module.symvers] Error 1
</span></span><span class=line><span class=cl>make[2]: *** Deleting file &#39;/tmp/selfgz3405/NVIDIA-Linux-x86_64-530.30.02/kernel/Module.symvers&#39;
</span></span><span class=line><span class=cl>make[2]: Target &#39;__modpost&#39; not remade because of errors.
</span></span><span class=line><span class=cl>make[1]: *** [Makefile:1830: modules] Error 2
</span></span><span class=line><span class=cl>make[1]: Leaving directory &#39;/usr/src/linux-headers-5.15.0-117-generic&#39;
</span></span><span class=line><span class=cl>make: *** [Makefile:82: modules] Error 2
</span></span><span class=line><span class=cl>ERROR: The nvidia kernel module was not created.
</span></span><span class=line><span class=cl>ERROR: Installation has failed.  Please see the file &#39;/var/log/nvidia-installer.log&#39; for details.  You may find suggestions on fixing installation problems in the README available on the Linux driver download page at www.nvidia.com.
</span></span></code></pre></td></tr></table></div></div><p>经过检查，发现问题其实很简单，是因为 g++ 等版本为 9，太高了，设置为 7 即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install gcc-7 g++-7
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 <span class=m>9</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class=m>1</span> 
</span></span><span class=line><span class=cl>sudo update-alternatives --display gcc
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 <span class=m>9</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 <span class=m>1</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --display g++
</span></span></code></pre></td></tr></table></div></div><p>之后再次运行，获得输出：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>===========
</span></span><span class=line><span class=cl>= Summary =
</span></span><span class=line><span class=cl>===========
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Driver:   Not Selected
</span></span><span class=line><span class=cl>Toolkit:  Installed in /usr/local/cuda-12.1/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make sure that
</span></span><span class=line><span class=cl> -   PATH includes /usr/local/cuda-12.1/bin
</span></span><span class=line><span class=cl> -   LD_LIBRARY_PATH includes /usr/local/cuda-12.1/lib64, or, add /usr/local/cuda-12.1/lib64 to /etc/ld.so.conf and run ldconfig as root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-12.1/bin
</span></span><span class=line><span class=cl>***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 530.00 is required for CUDA 12.1 functionality to work.
</span></span><span class=line><span class=cl>To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:
</span></span><span class=line><span class=cl>    sudo &lt;CudaInstaller&gt;.run --silent --driver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Logfile is /var/log/cuda-installer.log
</span></span></code></pre></td></tr></table></div></div><p>设置环境变量：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim ~/.bashrc <span class=c1># or ~/.zshrc</span>
</span></span></code></pre></td></tr></table></div></div><p>之后在最后添加：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/cuda-12.1/bin<span class=si>${</span><span class=nv>PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}}</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span>/usr/local/cuda-12.1/lib64<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                         <span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=si>}}</span>
</span></span></code></pre></td></tr></table></div></div><p>之后再 <code>source</code> 一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.bashrc <span class=c1># or ~/.zshrc</span>
</span></span></code></pre></td></tr></table></div></div><p>就可以正常的使用 CUDA 了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nvcc --version
</span></span></code></pre></td></tr></table></div></div><p>输出为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>nvcc: NVIDIA (R) Cuda compiler driver
</span></span><span class=line><span class=cl>Copyright (c) 2005-2023 NVIDIA Corporation
</span></span><span class=line><span class=cl>Built on Tue_Feb__7_19:32:13_PST_2023
</span></span><span class=line><span class=cl>Cuda compilation tools, release 12.1, V12.1.66
</span></span><span class=line><span class=cl>Build cuda_12.1.r12.1/compiler.32415258_0
</span></span></code></pre></td></tr></table></div></div><p>之后的 CUDNN 以及 torch 的安装就是按照提供的正常流程进行，完结撒花。</p><p>全部的指令包括以下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt upgrade
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo ubuntu-drivers autoinstall
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>reboot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt-get install gcc-7 g++-7
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 <span class=m>9</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class=m>1</span> 
</span></span><span class=line><span class=cl>sudo update-alternatives --display gcc
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 <span class=m>9</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 <span class=m>1</span>
</span></span><span class=line><span class=cl>sudo update-alternatives --display g++
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wget https://developer.download.nvidia.com/compute/cuda/12.1.0/local_installers/cuda_12.1.0_530.30.02_linux.run
</span></span><span class=line><span class=cl>sudo sh cuda_12.1.0_530.30.02_linux.run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo vim ~/.bashrc <span class=c1># or ~/.zshrc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### add following in .bashrc ###</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/local/cuda-12.1/bin<span class=si>${</span><span class=nv>PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}}</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span>/usr/local/cuda-12.1/lib64<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                         <span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=p>:+:</span><span class=si>${</span><span class=nv>LD_LIBRARY_PATH</span><span class=si>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>source</span> ~/.bashrc <span class=c1># or ~/.zshrc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wget https://developer.download.nvidia.com/compute/cudnn/9.3.0/local_installers/cudnn-local-repo-ubuntu2004-9.3.0_1.0-1_amd64.deb
</span></span><span class=line><span class=cl>sudo dpkg -i cudnn-local-repo-ubuntu2004-9.3.0_1.0-1_amd64.deb
</span></span><span class=line><span class=cl>sudo cp /var/cudnn-local-repo-ubuntu2004-9.3.0/cudnn-*-keyring.gpg /usr/share/keyrings/
</span></span><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get -y install cudnn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
</span></span><span class=line><span class=cl>./Miniconda3-latest-Linux-x86_64.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>conda create -n torch <span class=nv>python</span><span class=o>=</span>3.8
</span></span><span class=line><span class=cl>conda activate torch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pip3 install torch torchvision torchaudio
</span></span></code></pre></td></tr></table></div></div><p>之后在 python 中 <code>torch.cuda.is_available()</code> 返回为 <code>true</code>。</p><h2 id=ubuntu-2204-三系统安装以及安装显卡驱动后无线网卡恢复>Ubuntu 22.04 三系统安装以及安装显卡驱动后无线网卡恢复</h2><p>因为 Ubuntu 20.04 的若干的内容已经不再支持，使用起来最新的一些软件基本上全是报错，比较经典的就是 <code>GLIBC 2.3.1</code> 以及 <code>libssl.so.3</code> 等内容，而前者的安装十分的麻烦，所以干脆直接安装三系统。</p><p>三系统的安装不是很困难，使用之前安装 Ubuntu 20.04 的 EFI 分区作为挂载点就好，之后在系统的 GRUB 界面就可以看到三个系统了。</p><p>Ubuntu 22.04 有一个比较经典的问题，就是安装显卡驱动之后，会导致无线网卡消失，按照正常的流程进行操作之后，运行 <code>sudo ubuntu-drivers autoinstall</code> 并且重启，再次进入默认的系统之后，就会发现网卡消失了。</p><p>再次重启，进入 GRUB 之后选择 <code>Advanced options for ubuntu</code>，进去之后可以看到两个 Ubuntu 的版本以及对应的两个 recovery mode。两个版本里面比较新的一个是在安装显卡驱动之后新安装的版本，可以理解为显卡驱动对于较高版本的内核具有依赖，但是配套的无线没有一起安装，记下来两个版本的型号，然后选择较低版本的内核（不是 recovery mode）进入。</p><p>进入这一内核之后，可以发现网卡是有的，但是使用 <code>nvidia-smi</code>，并没有正常的那个输出界面，因为这个系统中内核不满足显卡驱动的依赖，那么把这个系统的版本提上去就好了。</p><p>使用 <code>sudo dpkg --get-selection | grep linux</code> 可以看到一些信息，其中一些项目包含版本号，有新版本的版本号，以及旧版本的，记下来这些旧版本的，并且使用 <code>sudo apt install</code> 安装使用新版本号覆盖旧版本号的这些内容。本人安装内容如下，作为参考：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install linux-headers-6.8.0-40-generic linux-image-6.8.0-40-generic linux-modules-6.8.0-40-generic linux-modules-extra-6.8.0-40-generic
</span></span></code></pre></td></tr></table></div></div><p>再次重启，正常进入正常的系统，恢复。</p><p>需要注意的是，越早设置这些内容，与本文档的对齐程度最高，本人的安装流程为，正常安装系统（将全部硬盘空间都挂在在 <code>/</code> 下）并设置语言为中文，进入系统之后更换语言为英文（因为不然的话输入法的安装比较麻烦），重启，将文件夹变为英文名，再重启，连接网络，<code>sudo apt update</code> 以及 <code>sudo apt upgrade</code>，最后就开始安装显卡驱动 <code>sudo ubuntu-drivers autoinstall</code> 并 <code>reboot</code> 重启。</p></section><footer class=article-footer><section class=article-tags><a href=/Blog/tags/tech-talk/>Tech Talk</a>
<a href=/Blog/tags/bug-report/>Bug Report</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under MIT</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/Blog/p/isaac-sim-%E8%B8%A9%E5%9D%91%E6%97%A5%E8%AE%B0/><div class=article-image><img src=/Blog/p/isaac-sim-%E8%B8%A9%E5%9D%91%E6%97%A5%E8%AE%B0/cover.6024f0bf6f60544ef12453d3f877b742_hu8627932685599706825.png width=250 height=150 loading=lazy alt="Featured image of post Isaac Sim 踩坑日记" data-hash="md5-YCTwv29gVE7xJFPT+He3Qg=="></div><div class=article-details><h2 class=article-title>Isaac Sim 踩坑日记</h2></div></a></article><article class=has-image><a href=/Blog/p/%E6%A0%A1%E5%9B%AD-vpn-%E8%BF%9E%E6%8E%A5%E5%AE%9E%E5%BD%95/><div class=article-image><img src=/Blog/p/%E6%A0%A1%E5%9B%AD-vpn-%E8%BF%9E%E6%8E%A5%E5%AE%9E%E5%BD%95/cover.244f8eb950140e59c894d0d62c2f3089_hu7156794404620403148.jpg width=250 height=150 loading=lazy alt="Featured image of post 校园 VPN 连接实录" data-hash="md5-JE+OuVAUDlnIlNDWLC8wiQ=="></div><div class=article-details><h2 class=article-title>校园 VPN 连接实录</h2></div></a></article><article class=has-image><a href=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%9F%B9%E8%AE%AD/><div class=article-image><img src=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%9F%B9%E8%AE%AD/cover.f1dcd12aa9e1c5128ea39849eefc477e_hu6185054173531065451.png width=250 height=150 loading=lazy alt="Featured image of post RoboMaster 视觉组第三次培训" data-hash="md5-8dzRKqnhxRKOo5hJ7vxHfg=="></div><div class=article-details><h2 class=article-title>RoboMaster 视觉组第三次培训</h2></div></a></article><article class=has-image><a href=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%9F%B9%E8%AE%AD/><div class=article-image><img src=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%9F%B9%E8%AE%AD/cover.3393779e7157f9cf01d07c7ad3e855ca_hu12486287441643169551.png width=250 height=150 loading=lazy alt="Featured image of post RoboMaster 视觉组第二次培训" data-hash="md5-M5N3nnFX+c8B0Hx60+hVyg=="></div><div class=article-details><h2 class=article-title>RoboMaster 视觉组第二次培训</h2></div></a></article><article class=has-image><a href=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%9F%B9%E8%AE%AD/><div class=article-image><img src=/Blog/p/robomaster-%E8%A7%86%E8%A7%89%E7%BB%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%9F%B9%E8%AE%AD/cover.94163e45c2d1f5a7ffa083f01a8e14f5_hu6804283126447262893.jpg width=250 height=150 loading=lazy alt="Featured image of post RoboMaster 视觉组第一次培训" data-hash="md5-lBY+RcLR9af/oIPwGo4U9Q=="></div><div class=article-details><h2 class=article-title>RoboMaster 视觉组第一次培训</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=Axi404/Blog data-repo-id=R_kgDOMN0OzQ data-category=Announcements data-category-id=DIC_kwDOMN0Ozc4CgmNX data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 Axi404</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/Blog/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>